#!/usr/bin/ruby --disable-gems

require_relative 'lib/repo_picker'
require 'open3'

if ARGV.include?('--refresh-dirs')
  RepoPicker.new.refresh_dirs
  exit 0
end

begin
  dir, name = RepoPicker.new.interactive_pick
  _, _, stat = Open3.capture3('kitty', '@', 'focus-tab', '--match', "title:^#{name}$")
  unless stat.success?
    Open3.capture3('kitty', '@', 'launch', "--cwd=#{dir}", '--type=tab', "--tab-title=#{name}")
  end
rescue RepoPicker::Aborted
  exit 1
end
