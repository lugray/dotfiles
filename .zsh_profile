if [ -e $HOME/.nix-profile/etc/profile.d/nix.sh ]; then
  . $HOME/.nix-profile/etc/profile.d/nix.sh
fi

if glibcLocales=$(nix-build --no-out-link "<nixpkgs>" -A glibcLocales 2> /dev/null); then
  export LOCALE_ARCHIVE_2_27="${glibcLocales}/lib/locale/locale-archive"
fi

if [ -d ~/.shellfuncs ]; then
  for FILE in ~/.shellfuncs/*.sh; do
    source $FILE
  done
fi

if [ -f ~/nerdfont/i_all.sh ]; then
  source ~/nerdfont/i_all.sh
fi

if [ -f ~/.shell_aliases ]; then
    . ~/.shell_aliases
fi

if [ -d $HOME/Library/Python/2.7/bin ]; then
  export PATH=$PATH:$HOME/Library/Python/2.7/bin
fi

zstyle ':completion:*' completer _complete _ignored
zstyle ':completion:*' matcher-list '' 'm:{[:lower:][:upper:]}={[:upper:][:lower:]}' 'r:|[._- ]=** r:|=**' 'l:|=* r:|=*'
zstyle :compinstall filename '/Users/lisaugray/.zshrc'
autoload -Uz compinit
compinit
HISTFILE=~/.histfile
HISTSIZE=1000000
SAVEHIST=1000000
setopt appendhistory autocd
HIST_STAMPS="yyyy-mm-dd"
export LC_ALL="en_US.UTF-8"
export EDITOR=nvim

source ~/src/github.com/zsh-users/zsh-autosuggestions/zsh-autosuggestions.zsh

###############
# Keybindings #
###############
function use-block-cursor {
  print -n -- "\E]50;CursorShape=0\C-G"
}

function use-line-cursor {
  print -n -- "\E]50;CursorShape=1\C-G"
}

function use-mode-cursor {
  case $KEYMAP in
    vicmd)
      use-block-cursor
      ;;
    *)
      use-line-cursor
      ;;
  esac

  zle reset-prompt
  zle -R
}

bindkey -v
bindkey kj vi-cmd-mode

if (( ${+terminfo[smkx]} )) && (( ${+terminfo[rmkx]} )); then
  function zle-line-init() {
    echoti smkx
    use-mode-cursor
  }
  function zle-line-finish() {
    echoti rmkx
    use-block-cursor
  }
  zle -N zle-line-init
  zle -N zle-line-finish
  zle -N zle-keymap-select use-mode-cursor
fi
if [[ "${terminfo[khome]}" != "" ]]; then
  bindkey "${terminfo[khome]}" beginning-of-line      # [Home] - Go to beginning of line
fi
if [[ "${terminfo[kend]}" != "" ]]; then
  bindkey "${terminfo[kend]}"  end-of-line            # [End] - Go to end of line
fi
bindkey '^A' beginning-of-line                        # [Cmd-LeftArrow] - requires iterm mapping to hex code 0x01
bindkey '^E' end-of-line                              # [Cmd-RightArrow] - requires iterm mapping to hex code 0x05
bindkey '^[[1;5C' forward-word                        # [Ctrl-RightArrow] - move forward one word
bindkey '^[[1;5D' backward-word                       # [Ctrl-LeftArrow] - move backward one word
if [[ "${terminfo[kcbt]}" != "" ]]; then
  bindkey "${terminfo[kcbt]}" reverse-menu-complete   # [Shift-Tab] - move through the completion menu backwards
fi
bindkey '^?' backward-delete-char                     # [Backspace] - delete backward
if [[ "${terminfo[kdch1]}" != "" ]]; then
  bindkey "${terminfo[kdch1]}" delete-char            # [Delete] - delete forward
else
  bindkey "^[[3~" delete-char
  bindkey "^[3;5~" delete-char
  bindkey "\e[3~" delete-char
fi
bindkey "¬µ" copy-prev-shell-word                    # Alt-m file rename magick

zle-dev-open-pr() /opt/dev/bin/dev open pr
zle -N zle-dev-open-pr
bindkey '√∏' zle-dev-open-pr # Alt-O ABC Extended
bindkey ' º' zle-dev-open-pr # Alt-O Canadian English

zle-dev-open-github() /opt/dev/bin/dev open github
zle -N zle-dev-open-github
bindkey '¬©' zle-dev-open-github # Alt-G ABC Extended & Canadian English

zle-dev-open-shipit() /opt/dev/bin/dev open shipit
zle -N zle-dev-open-shipit
bindkey '√ü' zle-dev-open-shipit # Alt-S ABC Extended & Canadian English

zle-dev-open-app() /opt/dev/bin/dev open app
zle -N zle-dev-open-app
bindkey '¬Æ' zle-dev-open-app # Alt-R ABC Extended & Canadian English

##################
# zsh git prompt #
##################
source ~/src/github.com/lugray/zsh-git-prompt/zshrc.sh
ZSH_THEME_GIT_PROMPT_PREFIX=" %{$reset_color%}["
ZSH_THEME_GIT_PROMPT_SUFFIX="%{$reset_color%}]"
ZSH_THEME_GIT_PROMPT_SEPARATOR="%{$reset_color%}|"
ZSH_THEME_GIT_PROMPT_BRANCH="%{$fg_bold[magenta]%}"
ZSH_THEME_GIT_PROMPT_STAGED="%{$fg[red]%}üé≠"
ZSH_THEME_GIT_PROMPT_CONFLICTS="%{$fg[red]%}üí•"
ZSH_THEME_GIT_PROMPT_CHANGED="%{$fg[yellow]%}üöß "
ZSH_THEME_GIT_PROMPT_BEHIND="%{$reset_color%}‚Üì"
ZSH_THEME_GIT_PROMPT_AHEAD="%{$reset_color%}‚Üë"
ZSH_THEME_GIT_PROMPT_UNTRACKED="%{$fg[cyan]%}üÜï"
ZSH_THEME_GIT_PROMPT_CLEAN="%{$fg_bold[green]%}${i_dev_git_pull_request}"
ZSH_THEME_GIT_PROMPT_STASHED="%{$fg[yellow]%}üì¶"
local italic=$'\e[3m'
PROMPTL1='‚ï≠‚îÄ%{$fg_bold[blue]${italic}%}%m%{${reset_color}%} %{$fg[cyan]%}%~%{${reset_color}%}$(git_super_status)'
PROMPTL2='‚ï∞‚îÄ%(?.%2{üêô%}.%{$fg[red]%}[%?]%{$reset_color%} %2{ü§¨%} ) '
PROMPT=${PROMPTL1}$'\n'${PROMPTL2}


source ~/src/github.com/zsh-users/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
